<!-- 注文詳細ページ -->
<%= notice %>
<h2>注文履歴詳細</h2>

<!-- 購入者情報 -->
<h4>購入者</h4>
<%= Member.find_by(id: @order.member_id).family_name %>
<%= Member.find_by(id: @order.member_id).first_name %>


<h4>配送先</h4>
<%= Address.find_by(id: @order.member_id).pastal_code %>
<%= Address.find_by(id: @order.member_id).address %>
<%= Address.find_by(id: @order.member_id).name %>


<h4>支払方法</h4>
<% if @order.pay_method == 0 %>
  <p>クレジットカード</p>
<% else %>
  <p>銀行振込</p>
<% end %>

<h4>注文ステータス</h4>
<%= form_for(@order, url:admins_order_path(@order.id)) do |f| %>
	<%= f.select :order_status, Order.order_statuses.keys %>
	<%= f.submit "更新" %>
<% end %>


<!-- テーブル -->
<div class="col-xs-12">
	<table>
		<thead>
			<tr>
				<th>商品名</th>
				<th>単価（税込）</th>
				<th>数量</th>
				<th>小計</th>
				<th>製作ステータス</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<% sum = 0 %>
				<% @order.order_items.each do |order_item| %>
				<td><%= order_item.product.name %></td>
				<td><%= number_to_currency(order_item.tax_price, :unit => "", :precision => 0) %></td>
				<td><%= order_item.quantity %></td>
				<% subtotal = order_item.tax_price * order_item.quantity %>
				<td><%= number_to_currency(subtotal, :unit => "", :precision => 0) %></td>
				<td><%= form_for(order_item, url: admins_order_item_path(order_item.id)) do |f| %>
					<%= f.select :making_status, [["着手不可", "着手不可"], ["製作待ち", "製作待ち"], ["製作中", "製作中"], ["製作完了", "製作完了"]] %>
					<%= f.submit '更新' %>
					<% end %>
				</td>
				<td></td>
				<% sum+=subtotal %>
				<% end %>
			</tr>
	    </tbody>
	</table>

			<table>
   				<table>
					<tbody>
						<tr>
							<th>商品合計</th>
							<td>
								<%= sum %>円
							</td>
						</tr>

						<tr>
							<th>配送料</th>
							<td>
								<%= @order.postage %>円
							</td>
						</tr>

						<tr>
							<th>ご請求額</th>
							<td>
								<%= sum + @order.postage %>円
							</td>
						</tr>
					</tbody>
  				</table>
			</table>
		</div>